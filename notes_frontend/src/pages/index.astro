---
import BaseLayout from "../layouts/BaseLayout.astro";
import TopBar from "../components/TopBar.astro";
import Sidebar from "../components/Sidebar.astro";
import ConfirmModal from "../components/ConfirmModal.astro";
import NoteEditor from "../components/NoteEditor.jsx";
---

<BaseLayout>
  <TopBar />
  <main class="h-[calc(100%-56px)] grid grid-rows-1 lg:grid-cols-[20rem_1fr]">
    <div class="lg:block hidden">
      <Sidebar />
    </div>
    <div class="block lg:hidden border-b border-gray-200">
      <details class="p-2">
        <summary class="o-btn-ghost">Browse notes</summary>
        <Sidebar />
      </details>
    </div>
    <section class="h-full">
      <NoteEditor client:load />
    </section>
  </main>
  <ConfirmModal title="Delete note" message="This action cannot be undone. Delete this note?" />
</BaseLayout>

<script>
  import { initStore, getState, createNote } from "../lib/storage.ts";

  function boot() {
    initStore();
    const s = getState();
    if (s.notes.length === 0) {
      const n = createNote();
      import("../lib/storage.ts").then(({ updateNote }) => {
        updateNote(n.id, {
          title: "Welcome to Simple Notes",
          content: "# Simple Notes\n\n- Create, edit, delete\n- Search and tag your notes\n\nUse Markdown in your content. Press Ctrl/Cmd+N to create a new note.",
          tags: ["welcome", "tips"]
        });
      });
    }
  }

  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", boot);
  } else {
    boot();
  }
</script>
